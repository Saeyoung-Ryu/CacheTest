@page "/indexeddb"
@inject IJSRuntime JS
@using DataModel
@using System.Text.Json

<h3>IndexedDB 예제</h3>

<MudButton Variant="Variant.Filled" OnClick="LoadFromIndexedDbAsync">Load Data</MudButton>

@if (loadedList != null)
{
    @foreach (var item in loadedList)
    {
        <MudText Typo="Typo.overline">@item.Course</MudText>
        <MudText Typo="Typo.overline">@item.Name</MudText>
        <MudText Typo="Typo.overline">@item.Id</MudText>

        <hr>
    }
}

@code {
    private List<SampleData>? loadedList { get; set; }

    private async Task LoadFromIndexedDbAsync()
    {
        try
        {
            string json = await JS.InvokeAsync<string>("indexedDbFunctions.getData", "sampleDataList");

            loadedList = JsonSerializer.Deserialize<List<SampleData>>(json, new JsonSerializerOptions
            {
                PropertyNameCaseInsensitive = true
            });

            Console.WriteLine($"Loaded {loadedList?.Count ?? 0} items from IndexedDB.");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading from IndexedDB: {ex.Message}");
        }
    }
}
